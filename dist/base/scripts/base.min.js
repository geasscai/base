"use strict";angular.module("app",["ngAnimate","ngResource","ngSanitize","ngTouch","ngStorage","angularMoment","oc.lazyLoad","ui.router","app.config","ui.bootstrap","ui.bootstrap.datetimepicker","ui.grid","ui.grid.selection","ui.grid.resizeColumns","ui.grid.pagination","schemaForm","app.controllers"]).run(["$log","$timeout","$state","$rootScope","amMoment","i18nService",function(e,t,n,r,o,i){i.setCurrentLang("zh-cn"),o.changeLocale("zh-cn")}]),angular.module("app.controllers",[]).controller("AppCtrl",["$scope","$location","$resource","$log","utils","$http","ENV",function(e,t,n,r,o,i,a){o.async("GET",a.menuApi,{}).then(function(t){var n=t.body;angular.isArray(n)||(n=n.items);var r=n.sort(function(e,t){return e.order-t.order});e.menus=o.initMenus(a.menuRoot,r),e.menus.length&&(e.menus[0].expanded=!0),e.menusCache=o.buildMenuTree(r)}),e.onSelect=function(e,t,n){location.hash=e.url},e.getMenus=function(t){return e.menusCache.filter(function(e){return e.label.contains(t)})},e.displayName=localStorage.getItem("displayName"),e.action={logout:function(){o.async("GET","logout").then(function(e){localStorage.removeItem("displayName"),location.reload()},function(e){location.reload()})}}}]),angular.module("app").config(["$stateProvider","$urlRouterProvider","$locationProvider","$ocLazyLoadProvider","plugins",function(e,t,n,r,o){r.config({});e.state("app",{url:"","abstract":!0,templateUrl:o.templates.layout,controller:"AppCtrl"}).state("login",{url:"/login",templateUrl:o.templates.login,controller:"app.login.index"}).state("app.dashboard",{url:"/dashboard",views:{content:{templateUrl:function(){return o.templates.dashboard},controller:"app.dashboard.index"}}}).state("app.list",{url:"/:name/:page",views:{content:{templateUrl:function(){return o.templates.list},controller:"app.wrap.list"}},resolve:{deps:["$ocLazyLoad","$stateParams","$http","utils",function(e,t,n,r){return e.load(["plugins/"+t.name+"/config.js"]).then(function(e){return e},function(e){console.log(e)})}]}});t.otherwise("/dashboard")}]),function(){angular.module("app").directive("changeTab",function(e){return{restrict:"A",link:function(e,t,n){$(t).click(function(e){$(this).parents(".tabbable").find(".active").removeClass("active"),$($(this).attr("change-tab")).addClass("active"),$(this).addClass("active"),e.stopPropagation()})}}}).directive("boxChangeShowHide",function(){return{restrict:"A",link:function(e,t,n){$(t).click(function(e){var t=$(this).children();t.hasClass("fa-chevron-up")?t.removeClass("fa-chevron-up").addClass("fa-chevron-down").parents(".util-box:eq(0)").children(".box-body").hide():t.removeClass("fa-chevron-down").addClass("fa-chevron-up").parents(".util-box:eq(0)").children(".box-body").show(),e.stopPropagation()})}}}).directive("onDomReady",function(e){return{restrict:"A",link:function(t,n,r){e(function(){var e=angular.element("#sidebar");n.on("click",".navbar-toggle.menu-toggler",function(t){var n=angular.element(this);n.toggleClass("display"),e.toggleClass("display"),t.stopPropagation()}),n.on("click",".toggle-open",function(e){angular.element(this).toggleClass("open"),e.stopPropagation()}),n.on("click",function(){angular.element(".toggle-open").removeClass("open")}),n.on("click",".tabbable.tabs-left li",function(e){var t=angular.element(this);angular.element(".tabbable.tabs-left li").not(t).removeClass("active"),t.addClass("active");var r=t.attr("id"),o=angular.element("#tab_"+r);n.parent().find(".tab-pane").removeClass("active"),o.addClass("active"),e.stopPropagation()})})}}}).directive("onFinishRender",function(e){return{restrict:"A",link:function(t,n,r){t.$last===!0&&e(function(){t.$emit("ngRepeatFinished")})}}}).directive("onMenuRender",function(e){return{restrict:"A",link:function(t,n,r){t.$last===!0&&e(function(){n.parent().on("click","li",function(e){var t=angular.element(this);t.hasClass("last-menu")&&angular.element(".last-menu.open").removeClass("open"),t.toggleClass("open").siblings().removeClass("open"),t.hasClass("open")?t.children(".submenu").show():t.children(".submenu").hide(),e.stopPropagation()})})}}}).directive("onSideBarRender",function(e){return{restrict:"A",link:function(t,n,r){e(function(){n.on("click","#sidebar-collapse",function(){n.toggleClass("menu-min"),n.find(".tabbable.tabs-left").toggleClass("hidden-ele"),angular.element("#sidebar-collapse").find("i").toggleClass("fa-angle-double-right")})})}}}).directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(e,t,n){t.replaceWith(t.children())}}}).directive("pageBar",["$location","utils",function(e,t){return{restrict:"EA",templateUrl:"base/templates/page-bar.html",replace:!0,scope:{conf:"="},link:function(n,r,o){function i(){if(null!=n.conf.totalItems){n.conf.currentPage=parseInt(n.conf.currentPage)?parseInt(n.conf.currentPage):1,n.conf.totalItems=parseInt(n.conf.totalItems),n.conf.itemsPerPage=parseInt(n.conf.itemsPerPage)?parseInt(n.conf.itemsPerPage):15,n.conf.numberOfPages=Math.ceil(n.conf.totalItems/n.conf.itemsPerPage),n.conf.currentPage<1&&(n.conf.currentPage=1),n.conf.currentPage>n.conf.numberOfPages&&(n.conf.currentPage=n.conf.numberOfPages),n.jumpPageNum=n.conf.currentPage;for(var e,t=n.conf.perPageOptions.length,r=0;t>r;r++)n.conf.perPageOptions[r]==n.conf.itemsPerPage&&(e=!0);if(e||n.conf.perPageOptions.push(n.conf.itemsPerPage),n.conf.perPageOptions.sort(function(e,t){return e-t}),n.pageList=[],n.conf.numberOfPages<=n.conf.pagesLength)for(r=1;r<=n.conf.numberOfPages;r++)n.pageList.push(r);else{var o=(n.conf.pagesLength-1)/2;if(n.conf.currentPage<=o){for(r=1;o+1>=r;r++)n.pageList.push(r);n.pageList.push("..."),n.pageList.push(n.conf.numberOfPages)}else if(n.conf.currentPage>n.conf.numberOfPages-o){for(n.pageList.push(1),n.pageList.push("..."),r=o+1;r>=1;r--)n.pageList.push(n.conf.numberOfPages-r);n.pageList.push(n.conf.numberOfPages)}else{for(n.pageList.push(1),n.pageList.push("..."),r=Math.ceil(o/2);r>=1;r--)n.pageList.push(n.conf.currentPage-r);for(n.pageList.push(n.conf.currentPage),r=1;o/2>=r;r++)n.pageList.push(n.conf.currentPage+r);n.pageList.push("..."),n.pageList.push(n.conf.numberOfPages)}}n.conf.onChange&&n.conf.onChange(),n.conf.currentPage<1&&(n.conf.currentPage=1)}}n.conf=n.conf||{},n.conf.currentPage=t.currentPage(),n.changeCurrentPage=function(t){return"..."==t?null:(n.conf.currentPage=t,void e.search("p",t))},n.conf.pagesLength=parseInt(n.conf.pagesLength)?parseInt(n.conf.pagesLength):9,n.conf.pagesLength%2===0&&(n.conf.pagesLength=n.conf.pagesLength-1),n.conf.perPageOptions||(n.conf.perPageOptions=[10,15,20,30,50]),n.prevPage=function(){n.conf.currentPage>1&&(n.conf.currentPage-=1)},n.nextPage=function(){n.conf.currentPage<n.conf.numberOfPages&&(n.conf.currentPage+=1)},n.jumpToPage=function(){n.jumpPageNum=n.jumpPageNum.replace(/[^0-9]/g,""),""!==n.jumpPageNum&&(n.conf.currentPage=n.jumpPageNum)},n.changeItemsPerPage=function(){},n.$watch("conf.totalItems",i)}}}]).directive("searchCommon",function(e){return{restrict:"E",templateUrl:e.templates.searchCommon,replace:!0,scope:{filtersConf:"=",filter:"=",onSearch:"&",operations:"="},link:function(e,t,n){},controller:["$scope","$attrs","$element","$rootScope","$timeout","$modal",function(e,t,n,r,o,i){function a(){e.filtersConf&&e.filtersConf.forEach(function(t){if("select"==t.type)null==e.filter[t.name]&&(e.filter[t.name]=""),e.selectChange(t);else if("department"==t.type||"people"==t.type){var n=null;"department"==t.type?n="base/templates/s.department.html":"people"==t.type&&(n="base/templates/s.people.html"),e.selectors[t.name]={turl:n,search:t}}})}e.selectChange=function(t){e.filtersConf.forEach(function(t){t.hide&&(t.hide=!1,t.lastValue?e.filter[t.name]=t.lastValue:delete e.filter[t.name])}),angular.forEach(t.options,function(n){n.hideKeys&&n.value==e.filter[t.name]&&n.hideKeys.split(",").forEach(function(t){e.filtersConf.forEach(function(n){n.name==t&&1!=n.hide&&(n.lastValue=e.filter[n.name],delete e.filter[n.name],n.hide=!0)})})})},e.selectors={},e.$watch("filtersConf",function(){a()}),e.dateChange=function(t){e.filter[t]&&(e.filter[t]=moment(e.filter[t]).format("YYYY-MM-DD"))},e.openDate=function(e,t){e.preventDefault(),e.stopPropagation(),t.opened=!0},e.reset=function(){e.filtersConf.forEach(function(e){e.lastValue=null}),e.filtersConf.forEach(function(t){"select"==t.type?(e.filter[t.name]="",e.selectChange(t)):delete e.filter[t.name]})},e.keyDown=function(t){var n=t||window.event;n&&13==n.keyCode&&e.onSearch()}}]}})}(),angular.module("app").controller("app.dashboard.index",["$scope","$stateParams","utils","ENV",function(e,t,n,r){var o=e;o.init=function(){},o.init()}]),angular.module("app").controller("app.wrap.list",["$scope","$stateParams","$timeout","$location","$log","$resource","$http","utils","explain","plugins",function(e,t,n,r,o,i,a,c,l,u){var s=e;s.action={search:function(){s.load()},reset:function(){angular.forEach(s.filter,function(e,t){"count"!=t&&delete s.filter[t]})},cancel:function(){console.log(s.form),angular.forEach(s.form.model,function(e,t){delete s.form.model[t]})},del:function(){var e=s.gridApi.selection.getSelectedRows()||[];angular.forEach(e,function(e){var n=[t.name,t.page].join("/");c.async("delete",n+"/"+e.uid).then(function(e){s.load()})})},create:function(){s.detailLoad(),s.form.schema||(s.scaffold=!0,s.form.model={type:"object",properties:[]},angular.forEach(s.headers,function(e,t){var n={};n.key=t,n.title=e,n.type="string",s.form.model.properties.push(n)}),s.form.schema={type:"object",properties:{properties:{type:"array",title:"字段设置",items:{type:"object",title:"属性名称",properties:{title:{type:"string",title:"名称"},required:{type:"boolean",title:"是否必填"},type:{type:"string",title:"类型","enum":["string","boolean","object"]},partten:{type:"string",title:"验证正则"},placeholder:{type:"string",title:"placeholder"}}}}}}),c.disableScroll()},save:function(e){if(s.$broadcast("schemaFormValidate"),e.$valid){var n=[t.name,t.page].join("/"),r=s.form.model.uid?"put":"post";if("put"==r&&(n=[n,s.form.model.uid].join("/"),delete s.form.model["new"]),s.form.model)for(var o in s.form.model)s.form.model.hasOwnProperty(o)&&angular.isDate(s.form.model[o])&&(s.form.model[o]=moment(s.form.model[o]).format("YYYY-MM-DD HH:mm:ss"));c.async(r,n,s.form.model).then(function(e){s.load(),s.events.trigger("closeDetail"),s.events.trigger("entrySaved")})}},close:function(){s.events.trigger("closeDetail")},bulk:function(){return s.gridApi.selection.getSelectedRows()||[]}},s.events=c.createEvents();var f=l.configuration(s),p=f.list.pageSize;s.init=function(){s.entries=[],s.filter={count:p},s.form=f.form,s.config=f,s.load(),s.events.trigger("listInit")},s.load=function(){var e=[t.name,t.page].join("/");c.async("GET",e,s.filter).then(function(e){var t=e.body;if(s.entries=t.items||[],s.headers=f.list.headers||t.headers,s.headers){var n=[];angular.forEach(s.headers,function(e,t){var r=angular.isObject(e)?e:{name:t,displayName:e};if(r.name=t,"json"==t){r.displayName="预约的手机号码",r.cellTemplate='<div class="ui-grid-cell-contents" title="{{row.entity.json }}">{{ row.entity.json | jsonParse:"phoneNumbers" }}</div>',n.push(r);var o={name:t+"2",displayName:e};o.displayName="预约的短信内容",o.cellTemplate='<div class="ui-grid-cell-contents" title="{{row.entity.json }}">{{ row.entity.json | jsonParse:"message" }}</div>',n.push(o)}else n.push(r)}),s.gridOptions.columnDefs=n}s.gridOptions.totalItems=t.count})},s.detailLoad=function(e){e||(e={}),s.entryCopy=angular.copy(e),s.detailUid=e.uid,s.form=s.form||{},s.form.model=e,s.detailUrl=f.form.template,c.disableScroll(),s.events.trigger("detailLoad",e)},s.paginationOptions={pageNumber:1,pageSize:p,sort:null},s.gridOptions={data:"entries",enablePaginationControls:!0,enableFiltering:!1,enableRowHeaderSelection:!1,useExternalPagination:!0,useExternalSorting:!0,onRegisterApi:function(t){s.gridApi=t,t.pagination.on.paginationChanged(e,function(e,t){s.filter.start=(e-1)*t,s.filter.count=t,s.load(),s.paginationOptions.pageNumber=e,s.paginationOptions.pageSize=t})},selectedItems:[],paginationPageSizes:[p,200,1e3],paginationPageSize:p,appScopeProvider:{onDblClick:function(e){s.detailLoad(e.entity)}},rowTemplate:'<div ng-dblclick="grid.appScope.onDblClick(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>'},s.events.on("closeDetail",function(){s.detailUrl=null,s.form.model={},c.resetScroll()}),s.init()}]),angular.module("app").controller("app.login.index",["$scope","$stateParams","$location","$resource","utils","ENV",function(e,t,n,r,o,i){e.filter={},e.login=function(){o.async("POST",i.apiPath+"/login",e.filter).then(function(t){localStorage.setItem("displayName",t.body.displayName||t.body.name),localStorage.setItem("username",e.filter.username),localStorage.setItem("password",e.filter.password);var r=decodeURIComponent(n.search()["return"]);r&&(location.hash=r),n.search("return",null)},function(e){o.alert(e.message)})}}]),angular.module("app").controller("app.selector",["$scope","utils","$ionicModal",function(e,t,n){function r(e,t,n){for(var o=t.u_id.split("_"),i="",a=0;n>=a;a++)i+=o[a],a!=n&&(i+="_");var c=e.filter(function(e){return i==e.u_id});c=c[0],n+2==o.length?(c.tree||(c.tree=[]),c.tree.push(t)):r(c.tree,t,++n)}function o(e){e&&e.forEach(function(e){e.check&&(e.check=!1),o(e.tree)})}function i(e,t){e&&e.forEach(function(e){e.check!=t&&(e.check=t),i(e.tree,e.check)})}function a(e,t){for(var n=0,r=e.length;r>n;n++){var o=e[n];if(o.u_id==t)return o;if(o.tree){var i=a(o.tree,t);if(i)return i}}}function c(e,t){t.forEach(function(t){t.check&&e.push(t),t.tree&&c(e,t.tree)})}function l(e,t){t.forEach(function(t){t.check&&e.push(t),!t.check&&t.tree&&l(e,t.tree)})}var u=e.search=e.$parent.selectors[e.$parent.currentName].search;e.count=0,e.loadDepartment=function(){t.async("GET","/api/department/all",{count:999999}).then(function(t){var n=t.items,o=[];n.forEach(function(e){var t=e.u_id;e.name=e.u_lname,-1==t.indexOf("_")?o.push(e):r(o,e,0)}),e.items=o},function(e){})},e.check=function(t){if(u.radio)t.check||o(e.items);else if(t.check){var n=t.u_id.split("_");n.pop();var r=n.join("_"),c=a(e.items,r);if(c&&c.check)return}t.check=!t.check,i(t.tree,t.check);var s=[];l(s,e.items),e.count=s.length};var s=null;e.back=function(){s.hide()},e.goAlreadySelect=function(){var t=[];l(t,e.items),e.topSelected=t,s?s.show():n.fromTemplateUrl("base/templates/s.alreadySelect.html",{scope:e}).then(function(e){s=e,s.show()})},e.okay=function(){var t=[];c(t,e.items);var n=[];l(n,e.items);var r=[],o=[];t.forEach(function(e){o.push(e.uid)}),n.forEach(function(e){r.push(e.name)}),e.$parent.departmentOkay(o,r)},e.cancel=function(){e.$parent.cancel()}}]),angular.module("app").filter("stringify",function(){return function(e){return angular.isObject(e)?JSON.stringify(e):e}}).filter("now",function(){return function(e){return moment(e).format("LLL")}}).filter("jsonParse",function(){return function(e){if(angular.isString(e)&&2==arguments.length&&0==e.indexOf("{")){var t=[],n=JSON.parse(e);return angular.forEach(arguments[1].split(","),function(e){t.push(n[e])}),t.join(";")}return e}}).filter("protocol",function(){return function(e){return/^\/\//gi.test(e)?"https:"+e:e}}),angular.module("app").factory("authInterceptor",["$rootScope","$q","$window","$location",function(e,t,n,r){var o=!0;return{request:function(e){return e},response:function(e){return e||t.when(e)},responseError:function(e){return 401===e.status&&o&&(o=!1,r.path("/login").search("return",encodeURIComponent(location.hash)),setTimeout(function(){o=!0},12e3)),t.reject(e)}}}]).config(["$httpProvider",function(e){e.defaults.withCredentials=!0,e.interceptors.push("authInterceptor")}]),angular.module("app").factory("explain",["$stateParams","oPath","ENV","plugins","utils",function(e,t,n,r,o){var i=angular.element(document.body).injector(),a=function(e,t){for(var n={},r=0;r<e.length;++r)e[r].hasOwnProperty(t)?n[e[r][t]]=e[r]:n[r]=e[r];return n},c=function(e,t){try{return i.get(e+".config")[t]}catch(n){return null}},l=function(e,t){angular.isFunction(e)?i.invoke(e,t):angular.isArray(e)&&angular.forEach(e,function(e){l(e,t)})},u=function(e,n){var r=t.get(e,"operation",[]);if(!r)return e;var o=[],a={add:{name:"新建",action:n.action.create},del:{name:"删除",action:n.action.del}},c={scope:n};return angular.forEach(r,function(e,t){if(e){var n=a[t]||{name:e.name,action:e.action};angular.isFunction(e.action)&&(n.action=function(){i.invoke(e.action,c)}),o.push(n)}}),e.operations=o,e},s=function(e,n){var r={scope:n,list:e.list},o=t.get(e,"list.resolves",[]);return l(o,r),e},f=function(e,t,n){e&&(e[t]=e[t]||angular.copy(n))},p=function(e,t){if(!e)throw"can not override properties with null";for(var n in t)t.hasOwnProperty(n)&&f(e,n,t[n])},g=function(e,n){var r=t.get(e,"schema.properties",{});angular.isArray(r)&&(e.schema.properties=a(r,"key"));var o={scope:n,form:e.form};angular.isArray(e.form)&&angular.forEach(e.form,function(t){angular.forEach(t.items,function(t){("datepicker"==t.type||"datetimepicker"==t.type)&&(t.title=t.title||e.schema.properties[t.key].title,t.open=function(e){e.preventDefault(),e.stopPropagation(),t.opened=!0}),angular.isObject(t)&&(t.required=t.required||e.schema.properties[t.key].required)})});var i=t.get(e,"resolves",[]);return l(i,o),e},d=function(t){if(!angular.isUndefined(t)){if(0==t.indexOf("http")||t.indexOf("plugins")>-1)return t;var r=[n.pluginFolder,e.name,"templates",t].join("/").replace(/\/\//g,"/");return[o.root,r].join("/")}},m=function(){var t=c(e.name,"__default")||{};return t=angular.extend({list:{},form:{}},t),f(t.form,"template",[o.root,r.templates.detail].join("/")),f(t.list,"template",[o.root,r.templates.list].join("/")),f(t.list,"pageSize",n.pageSize["default"]),t};return{configuration:function(t){var n=m(),r=c(e.name,e.page)||{};return f(r,"form",{}),f(r,"list",{}),p(r.form,n.form),p(r.list,n.list),r.list.template=d(r.list.template),r.form.template=d(r.form.template),console.log(r.form.template),r=u(r,t),r=s(r,t),r.form=g(r.form,t),r}}}]),angular.module("app").factory("fileSize",function(){function e(e,t){return e&&e.toLowerCase()===t.toLowerCase()}var t="BKMGTPEZY".split("");return function(n,r){return n="number"==typeof n?n:0,r=r||{},r.fixed="number"==typeof r.fixed?r.fixed:2,r.spacer="string"==typeof r.spacer?r.spacer:" ",r.calculate=function(t){var o,i=e(t,"si")?["k","B"]:["K","iB"],a=e(t,"si")?1e3:1024,c=Math.log(n)/Math.log(a)|0,l=n/Math.pow(a,c),u=l.toFixed(r.fixed);return 3>c-1&&!e(t,"si")&&e(t,"jedec")&&(i[1]="B"),o=c?(i[0]+"MGTPEZY")[c-1]+i[1]:1===(0|u)?"Byte":"Bytes",{suffix:o,magnitude:c,result:l,fixed:u,bits:{result:l/8,fixed:(l/8).toFixed(r.fixed)}}},r.to=function(r,o){var i=e(o,"si")?1e3:1024,a=t.indexOf("string"==typeof r?r[0].toUpperCase():"B"),c=n;if(-1===a||0===a)return c.toFixed(2);for(;a>0;a--)c/=i;return c.toFixed(2)},r.human=function(e){var t=r.calculate(e);return t.fixed+r.spacer+t.suffix},r}}),angular.module("app").factory("oPath",[function(){var e=function(){function e(e){if(!e)return!0;if(i(e)&&0===e.length)return!0;if(!r(e)){for(var t in e)if(f.call(e,t))return!1;return!0}return!1}function t(e){return s.call(e)}function n(e){return"number"==typeof e||"[object Number]"===t(e)}function r(e){return"string"==typeof e||"[object String]"===t(e)}function o(e){return"object"==typeof e&&"[object Object]"===t(e)}function i(e){return"object"==typeof e&&"number"==typeof e.length&&"[object Array]"===t(e)}function a(e){return"boolean"==typeof e||"[object Boolean]"===t(e)}function c(e){var t=parseInt(e);return t.toString()===e?t:e}function l(t,o,i,a){if(n(o)&&(o=[o]),e(o))return t;if(r(o))return l(t,o.split(".").map(c),i,a);var u=o[0];if(1===o.length){var s=t[u];return void 0!==s&&a||(t[u]=i),s}return void 0===t[u]&&(t[u]=n(o[1])?[]:{}),l(t[u],o.slice(1),i,a)}function u(t,o){if(n(o)&&(o=[o]),e(t))return void 0;if(e(o))return t;if(r(o))return u(t,o.split("."));var a=c(o[0]),l=t[a];if(1===o.length)void 0!==l&&(i(t)?t.splice(a,1):delete t[a]);else if(void 0!==t[a])return u(t[a],o.slice(1));return t}var s=Object.prototype.toString,f=Object.prototype.hasOwnProperty,p=function(e){return Object.keys(p).reduce(function(t,n){return"function"==typeof p[n]&&(t[n]=p[n].bind(p,e)),t},{})};return p.has=function(t,a){if(e(t))return!1;if(n(a)?a=[a]:r(a)&&(a=a.split(".")),e(a)||0===a.length)return!1;for(var c=0;c<a.length;c++){var l=a[c];if(!o(t)&&!i(t)||!f.call(t,l))return!1;t=t[l]}return!0},p.ensureExists=function(e,t,n){return l(e,t,n,!0)},p.set=function(e,t,n,r){return l(e,t,n,r)},p.insert=function(e,t,n,r){var o=p.get(e,t);r=~~r,i(o)||(o=[],p.set(e,t,o)),o.splice(r,0,n)},p.empty=function(t,c){if(e(c))return t;if(e(t))return void 0;var l,u;if(!(l=p.get(t,c)))return t;if(r(l))return p.set(t,c,"");if(a(l))return p.set(t,c,!1);if(n(l))return p.set(t,c,0);if(i(l))l.length=0;else{if(!o(l))return p.set(t,c,null);for(u in l)f.call(l,u)&&delete l[u]}},p.push=function(e,t){var n=p.get(e,t);i(n)||(n=[],p.set(e,t,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},p.coalesce=function(e,t,n){for(var r,o=0,i=t.length;i>o;o++)if(void 0!==(r=p.get(e,t[o])))return r;return n},p.find=function(t,o,a){if(n(o)&&(o=[o]),e(o))return t;if(e(t))return a;r(o)&&p.find(t,o.split("."),a);var l=c(o[0]);if(/\[(.*?)\]/g.test(l)&&i(t))for(var u=/\[(.*?)\]/g.exec(l)[1],s=u.split(":"),f=0;f<t.length;f++)if(t[f].hasOwnProperty(s[0])&&t[f][s[0]]==s[1])return p.find(t[f],o.slice(1),a);return 1===o.length?void 0===t[l]?a:t[l]:p.find(t[l],o.slice(1),a)},p.get=function(t,o,i){if(n(o)&&(o=[o]),e(o))return t;if(e(t))return i;if(r(o))return p.get(t,o.split("."),i);var a=c(o[0]);return 1===o.length?void 0===t[a]?i:t[a]:p.get(t[a],o.slice(1),i)},p.del=function(e,t){return u(e,t)},p}();return e}]),angular.module("app").factory("utils",["$http","$q","$location","$stateParams","ENV","gateway",function(e,t,n,r,o,i){var a=o.headers,c={async:function(n,r,o,i){var l={method:n,url:r,cache:!1,headers:i||a};o&&angular.forEach(o,function(e,t){""==e&&delete o[t]}),o&&("post"==n.toLowerCase()||"put"==n.toLowerCase())&&a["Content-Type"].indexOf("json")>0?l.data=o:o&&(l.data=this.serialize(o));var u=t.defer();return r?(l.data&&"get"==l.method.toLowerCase()&&(l.url=l.url+"?"+l.data),e(l).success(function(e){if(0!=e.error&&e.error)if(e["@timestamp"]){var t=c.parseView(e);u.resolve({items:t})}else u.reject(e.message?e:{message:"服务器异常"});else u.resolve(e)}).error(function(e){u.reject({message:"无法连接到服务器"})}),u.promise):void u.reject({message:"Uri is empty!"})},serialize:function(e){if(!angular.isObject(e))return null==e?"":e.toString();var t=[];for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];angular.isDate(r)&&moment&&(r=moment(r).format("YYYY-MM-DD HH:mm:ss")),t.push(encodeURIComponent(n)+"="+encodeURIComponent(null==r?"":r))}var o=t.join("&");return o},createDoc:function(e){return e&&e.properties&&angular.isArray(e.properties)&&(angular.forEach(e.properties,function(t){e[t.name]=1==t.value.length?t.value[0]:t.value}),delete e.properties),e}},l={"default":"ico ico-file ico-file-1",xls:"ico ico-file ico-file-2",xlsx:"ico ico-file ico-file-2",doc:"ico ico-file ico-file-3",docx:"ico ico-file ico-file-3",ppt:"ico ico-file ico-file-4",pptx:"ico ico-file ico-file-4",rar:"ico ico-file ico-file-6",zip:"ico ico-file ico-file-7",html:"ico ico-file ico-file-10",js:"ico ico-file ico-file-11",xml:"ico ico-file ico-file-12",css:"ico ico-file ico-file-12",pdf:"ico ico-file ico-file-17",txt:"ico ico-file ico-file-22",jpg:"ico ico-file ico-file-31",gif:"ico ico-file ico-file-32",png:"ico ico-file ico-file-33",bmp:"ico ico-file ico-file-34"},u=function(e,t){return t.filter(function(n){var r=n.parent==e&&n.type&&"menu"==n.type.toLowerCase();return"#"==n.url&&(n.url=""),r&&(n.subMenus=u(n.uid,t)),r})},s=function(e){var t=[];return angular.forEach(e,function(n){var r={label:n.name,url:n.url,parent:n.parent,uid:n.uid};r.parents=[],f(r,r,e),r.name=r.parents.reverse().join(" > "),t.push(r)}),t},f=function(e,t,n){var r=n.filter(function(e){return e.uid==t.parent});0==e.parents.length&&e.parents.push(e.label),r.length&&(e.parents.push(r[0].name),f(e,r[0],n))},p=function(){var e={};return{on:function(t,n){return t.split(" ").forEach(function(t){e[t]||(e[t]=[]),e[t].push(n)}),this},once:function(t,n){return t.split(" ").forEach(function(t){e[t]=[],e[t].push(n)}),this},trigger:function(t,n){return angular.forEach(e[t],function(e){e.call(null,n)}),this}}},g=new p,d=function(e){try{return angular.element(document.body).injector().get(e)}catch(t){return null}},m="self"!==i.host?i.host:location.protocol+"//"+location.host,h=m+location.pathname.substr(0,location.pathname.lastIndexOf("/")),v=function(e){var t=e.split("/");return o.mock&&t.length?"data/"+t.slice(3).join(".")+".json":e};return{alert:function(e,t){console.log(e,t)},root:h,host:m,serialize:c.serialize,format:function(e){var t=Array.prototype.slice.call(arguments,1);return e?e.replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof t[n]?t[n]:e}):""},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},createEvents:function(){return new p},events:g,initMenus:u,buildMenuTree:s,changeTitle:function(e){g.trigger("changeTitle",e)},currentPage:function(){var e=n.search()[e];return parseInt(e)||1},async:function(e,t,n){var r=t;return 0==t.indexOf("http")?r=t:(0!==t.indexOf(o.apiPath)&&(r=[o.apiPath,t].join("/").replace(/\/\//g,"/")),r=[m,r].join("/")),r=v(r),c.async(e,r,n)},findViewConfig:function(e,t){return d(e+".config")[t]},disableScroll:function(){document.body.style.overflow="hidden",angular.element(window).trigger("resize")},resetScroll:function(){document.body.style.overflow=null,angular.element(window).trigger("resize")},getFileExtCss:function(e){var t=/(?:\.([^.]+))?$/,n=t.exec(e)[1];return l.hasOwnProperty(n)?l[n]:l["default"]}}}]);